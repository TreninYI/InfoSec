# Курсовая работа "E-Commerce" (Профессия Специалист по информационной безопасности)

## Описание

Компания Y предоставляет комплексное веб-приложение в сфере электронной коммерции `Necommerce`. Компания недавно столкнулась с массовой утечкой данных о своих пользователях и их покупках. «Брешь», через которую произошла утечка, вроде как устранили.

Саму разработку приложения компания Y заказывает у подрядчика — фирмы-разработчика.

Своих специалистов по информационной безопасности у компании Y нет, поэтому вас пригласили провести комплексный анализ процесса разработки и протестировать на наличие других веб-уязвимостей. Детали по найденным и исправленным уязвимостям не дали, так как вы профессионал и должны проверить всё с начала.

Разработчики со стороны подрядчика также максимально пошли вам на встречу и предоставили исчерпывающую информацию о приложении — две ссылки на репозитории с кодом:
* [Frontend](https://github.com/netology-code/necommerce-frontend).
* [Backend](https://github.com/netology-code/necommerce-backend).

**По словам разработчиков:**
1. Вся разработка ведётся в приватных репозиториях в GitHub. *Это легенда, для удобства мы вам дали открытые репозитории*.

2. Весь код, а также зависимости и контейнеры, регулярно  проходят проверку открытыми инструментами:
    * [Dependabot](https://dependabot.com).
    * [Detekt](https://detekt.github.io/detekt/).
    * [Snyk](https://snyk.io/) и т. д.
    
3. Сам код покрыт автоматическими тестами, включая проверку механизмов безопасности (отработка неверных логинов и паролей), которые регулярно прогоняются при каждом push в репозиторий.

4. Разработчики прекрасно знакомы с `OWASP Top 10`, а некоторые даже с `ASVS` и `WSTG`.

5. Они придерживаются строгих правил разработки и не разрешают отправлять `push` в `master` без соответствующего `Code Review` как минимум двух человек и прохождения автоматизированных проверок.

6. После прохождения всех проверок автоматически собираются образы `Docker` и публикуются в `GitHub Container Registry` для дальнейшего разворачивания в Production.

Отчёты этих инструментов скрыты из публичного доступа. При желании вы можете `Fork`'нуть репозиторий и самостоятельно настроить репозиторий, либо обратиться к руководителю курса, чтобы он вас добавил временно в репозиторий для просмотра настроек инструментов.

## Инструкция по запуску

Используйте файл `docker compose`:
```
version: '3.7'
services:
  backend:
    image: ghcr.io/netology-code/necommerce-backend
    ports:
      - 9999:9999
  frontend:
    image: ghcr.io/netology-code/necommerce-frontend
    environment:
      - API=http://backend:9999
      - MEDIA=http://backend:9999
    ports:
      - 8888:80
    depends_on:
      - backend
```

## Задача

**Ваша ключевая задача** — провести комплексное исследование функционирующего приложения и исходных кодов. Обратите внимание на код приложения, всё ли в порядке с зависимостями, верно ли собираются контейнеры и т. д.

В задачу не закладывается требование выучить используемые в системе языки программирования. Достаточно знания английского языка и умения гуглить важные моменты, например, как в том или ином языке работать с генерацией случайного набора данных, или что такое `CORS`, `CSRF` и т. д.

В качестве отчётных документов прикладываются:
1. Документ (doc, odf, pdf или issue в GitHub) со скриншотами и описанием обнаруженных проблем, если они есть.
2. Документ с рекомендациями улучшения процесса, кода, подходов, применения новых практик и т. д.

# Отчет   

Для начала я просто изучил веб-приложение вручную.
Обнаружено, что можно зарегистрироваться, используя простой пароль. (был использован 12345).

![image1](https://github.com/TreninYI/InfoSec/assets/121427985/2e431c86-da38-42d3-8002-46240232109a)

 
Попробовал `SQLi` в простой форме. Инъекция не сработала.  

![image2](https://github.com/TreninYI/InfoSec/assets/121427985/829952bb-e5e9-4eae-8277-61a9391c970e)

Выявил, что с помощью `Wireshark` можно узнать `id`, он же логин клиента, а также номер телефона.

![image3](https://github.com/TreninYI/InfoSec/assets/121427985/6dad2c65-923a-4684-81a2-7ea1f655079e)


## Далее для анализа веб-приложения использую `Zap`:

Скриншот 1:

![image3](https://github.com/TreninYI/InfoSec/assets/121427985/e539b6a9-c533-4039-813f-d2eedc04e2ca)


Скриншот 2:

![image4](https://github.com/TreninYI/InfoSec/assets/121427985/93223add-0ef6-42d0-a477-ba900a0d987b)


Скриншот 3:

![image5](https://github.com/TreninYI/InfoSec/assets/121427985/e912e734-b7bd-445b-977b-9ebc82f2a662)


Скриншот 4: 

![image6](https://github.com/TreninYI/InfoSec/assets/121427985/e248adeb-5ab8-4391-93aa-0eb3a8b4a26f)


Ниже можно ознакомиться с описанием уязвимостей, которые были взяты c сайта [CWE](https://cwe.mitre.org/).

Скриншот 1:	 CWE-1021: Неверное ограничение визуализируемых слоев или фреймов пользовательского интерфейса https://cwe.mitre.org/data/definitions/1021


Скриншот 2:  CWE-264: Разрешения, привилегии и контроль доступа https://cwe.mitre.org/data/definitions/264.html


Скриншот 3:  CWE-693: Сбой механизма защиты https://cwe.mitre.org/data/definitions/693


Скриншот 4:  CWE-200: Раскрытие конфиденциальной информации неавторизованному субъекту https://cwe.mitre.org/data/definitions/200.html


## Далее для анализа кода использовал `Snyk`:

Код фронтенда:

![image7](https://github.com/TreninYI/InfoSec/assets/121427985/da842e49-de37-4c96-a3cf-c57529bcadb1)

Команда для запуска:

![image8](https://github.com/TreninYI/InfoSec/assets/121427985/3a699bae-605b-4f08-ab62-44d56253b82a)

  
Были получены результаты представленные ниже:

![image9](https://github.com/TreninYI/InfoSec/assets/121427985/07ac7384-33b0-4e3d-ae60-badec59b9464)

![image10](https://github.com/TreninYI/InfoSec/assets/121427985/22de7972-fd02-421d-b193-62feb37b8573)

![image11](https://github.com/TreninYI/InfoSec/assets/121427985/ba41d830-0888-43b9-8555-a172e258f1ea)

![image12](https://github.com/TreninYI/InfoSec/assets/121427985/7b1499eb-b44f-4e57-9762-19441c93213f)


По итогу сканирования фронтенда я выяснил что у нас есть 300 проблем (некоторые из них представлены выше на скриншотах:
Выборочно взятые проблемы:

- CWE-190: целочисленное переполнение или перенос https://cwe.mitre.org/data/definitions/190.html
- CWE-787: Запись за пределы допустимого диапазона https://cwe.mitre.org/data/definitions/787.html
- CWE-287: Неправильная аутентификация https://cwe.mitre.org/data/definitions/287
- CWE-835: цикл с недостижимым условием выхода («бесконечный цикл») https://cwe.mitre.org/data/definitions/835
- CWE-770: Распределение ресурсов без ограничений или регулирования https://cwe.mitre.org/data/definitions/770

Далее выполнил сканирование на уязвимости бекенд:

Команда для запуска:

![image13](https://github.com/TreninYI/InfoSec/assets/121427985/a28b3a85-66f7-48ed-857f-909cdfc33f00)

Были получены результаты представленные ниже:

![image13](https://github.com/TreninYI/InfoSec/assets/121427985/e2ee632e-7252-4e9e-bc7a-6f485ef94f35)

![image14](https://github.com/TreninYI/InfoSec/assets/121427985/e88e85f4-9966-4529-a4c1-51cc55056a65)

![image15](https://github.com/TreninYI/InfoSec/assets/121427985/ca944d0a-bfc6-49cc-bd0c-550fce6252b4)

![image16](https://github.com/TreninYI/InfoSec/assets/121427985/084f27e3-1dfe-49ee-9feb-97ee3cee25c5)


По итогу сканирования бекенда было выявлено множество уязвимостей. Как оказалось, довольно много проблем можно решить банальным обновлением, как нам сообщает программа.
Выборочный список проблем бекэнда:
- CWE-200: Раскрытие конфиденциальной информации неавторизованному субъекту https://cwe.mitre.org/data/definitions/200.html
- CWE-122: Переполнение буфера в динамической памяти https://cwe.mitre.org/data/definitions/122.html
- CWE-522: Недостаточно защищенные учетные данные https://cwe.mitre.org/data/definitions/522.html
- CWE-61: Символическая ссылка UNIX https://cwe.mitre.org/data/definitions/61.html
- CWE-94: Неправильный контроль генерации кода («внедрение кода») https://cwe.mitre.org/data/definitions/94

## Далее с помощью `truffleHog` удалось получить некие данные при сканировании: 

Команда для запуска и часть вывода об уязвимостях на фронтенде:

![image17](https://github.com/TreninYI/InfoSec/assets/121427985/3876a182-c7fa-4537-b4f5-d7f5fba35dfc)

![image18](https://github.com/TreninYI/InfoSec/assets/121427985/fb67c536-5da2-4033-880f-95421e02b036)

Команда для запуска и часть вывода об уязвимостях на бекенде:

![image19](https://github.com/TreninYI/InfoSec/assets/121427985/0d5ad06c-5d76-4f8b-8759-a19b17fcde32)

![image20](https://github.com/TreninYI/InfoSec/assets/121427985/83614213-e6f6-43e6-8225-f2372af7eee3)


## Анализ `CI/CD` с помощью программы `semgrep`:

Сканирование проводилось командами: 

```bash
semgrep scan --config auto и semgrep --config "p/docker-compose"
```

Сканирование выявило в сборке докера присутствие дополнительных привилегий, которые необходимо убрать.

![image21](https://github.com/TreninYI/InfoSec/assets/121427985/76a6aa03-6b9b-43e7-9681-e8f5850c2633)

## Анализ образов контейнеров при помощи `Trivy`:

Команды запуска проверки:
```bash
trivy image --scanners secret,vuln,config ghcr.io/netology-code/necommerce-backend
```
```bash
trivy image --scanners secret,vuln,config ghcr.io/netology-code/necommerce-frontend
```

После проверки контейнеров было выявлено множество слабостей. Опять же я встретил, что требуется обновление версии ПО для избавления от уязвимости:

![image22](https://github.com/TreninYI/InfoSec/assets/121427985/393fe046-19fe-4ac1-8fd0-d970934f6395)

Так же обнаружил ошибки переполнения, когда можно добыть некую информацию или повесить сервер:

![image23](https://github.com/TreninYI/InfoSec/assets/121427985/5f0980ff-e410-42a9-b101-baf9495b3e01)

Выявлена ошибка неверной логики, когда запрос PUT заставляет заново запрашивать данные у сервера, даже когда стоит запрет на это:

![image23](https://github.com/TreninYI/InfoSec/assets/121427985/1e3ad49e-d90b-41c6-9878-2d0053b9aaac)

При проверке были обнаружены слабости представленые ниже: 

![image24](https://github.com/TreninYI/InfoSec/assets/121427985/1afdeb13-0912-4f2e-bb20-f55b5dc47687)

Выявил что, возможна `XML External Entity (XXE) Injection` для получения каких-либо данных изнутри:

![image25](https://github.com/TreninYI/InfoSec/assets/121427985/f75145ff-c25d-4c4c-9c44-1194634004d2)

 
Увидел, что есть возможность для удаленного выполнения кода `(RCE)` через привязку данных:

![image26](https://github.com/TreninYI/InfoSec/assets/121427985/58cea044-a34f-48ee-ae91-eaefd0de7019)


Мной был найден секрет в виде `service-account c id`, паролем и токенами:

![image27](https://github.com/TreninYI/InfoSec/assets/121427985/6005859c-8ae5-4f5e-9be8-18b4aaa6248d)

На скриншоте ниже можно увидеть, что была найдена слабость в сборке контейнера докер - сборка с повышенными привилегиями (от root пользователя):

![image28](https://github.com/TreninYI/InfoSec/assets/121427985/558d6905-6ab6-4e44-8adb-c78a914a021c)

 


# Рекомендации: 
Хорошо видно, что данное веб-приложение имеет как серьезные, так и не серьезные недостатки.
1.	Использовать надежные пароли при регистрации новых пользователей.
2.	Регулярно обновлять веб приложение.
3.	Регулярно проверять приложение на уязвимости, стараться их устранить.
4.	Необходимо удалить секрет или же зашифровать данные, чтобы ими не могли воспользоваться злоумышленники.
5.	Запретить неавторизированным объектам иметь допуск к информации.
6.	Запуск контейнеров с правами пользователя root может привести к ситуации выхода контейнера из строя. Рекомендуется запускать контейнеры от имени пользователей, не являющихся пользователями root, что можно сделать, добавив инструкцию 'USER' в Dockerfile.
7.	Используйте стратегию проверки входных данных “принять заведомо хорошие”, т.е. используйте список приемлемых входных данных, которые строго соответствуют спецификациям. Отклоняйте любые входные данные, которые строго не соответствуют спецификациям, или преобразуйте их во что-то, что соответствует.
8.	Лучше продумывать код, для невозможности злоумышленником внести изменение, для получение конфиденциальной информации.
9.	При сборке контейнеров backend и frontend необходимо добавить флаг: --security-opt=no-new-privileges,это не даст повышение привилегий.
10. Также при необходимости добавить запись read_only: true, чтобы запретить вредоносным приложениям загружать и запускать дополнительную полезную нагрузку или изменять файлы-контейнеры в корневой папке. 

